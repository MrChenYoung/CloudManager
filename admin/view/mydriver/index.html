<{extends file="layout.html"}>
<{block name="myStyles"}>
<style type="text/css">
    .aw-content-wrap .icon {
        background-color: #393D49;
        margin-right: 10px;
    }

    .layui-table thead th{
        text-align: center;
        font-weight: bold;
    }
</style>
<{/block}>
<{block name="scriptCode"}>
<script>
    $(document).ready(function () {
        // 设置边栏服务器信息选中状态
        $("#my_driver").addClass("active");

        // 请求云盘列表
        loadDriverList();
    });

    // 请求云盘列表
    function loadDriverList() {
        var url = "?m=admin&c=API_MyDriver&a=loadDriverList&API=";
        get(url,function (data) {
            // 创建云盘列表
            createDriverDoms(data.data);
        });
    }

    // 创建云盘列表
    function createDriverDoms(data) {
        var dom = "";
        for(var i = 0; i < data.length; i++){
            var driver = data[i];
            dom += '<tr mouseRgihtData="'+ driver["name"] +'"><td>'+ driver["name"] +'</td>';
            dom += '<td>'+ driver["type"] +'</td>';
            dom += '<td><i title="删除" driverName="'+ driver["name"] +'" onclick="deleteDriver(this)" style="cursor: pointer" class="icon icon-trash"></i></td></tr>';
        }

        // 添加分类一行
        $("tbody").html(dom);

        // 添加右键菜单
        var menu_data=[
            {'type':1,'icon':'icon-zhongmingming','title':'重命名'},
            {'type':2,'icon':'icon-icon_del','title':'删除'}
        ];
        mouseRightMenuInit($(".layui-table tbody tr"),menu_data,function (menuData) {
            var opeType = menuData.type;
            var driveName = menuData.data.content;
            console.log("type:" + typeof(opeType));
            switch (opeType) {
                case 1:
                    // 重命名
                    renameDriver(driveName);
                    break;
                case 2:
                    // 删除
                    deleteDriver(driveName);
                    break;
            }
        });
    }

    // 删除云盘
    function deleteDriver(driveName) {
        confirmAlert(function () {
            var url = baseUrl + "?m=admin&c=API_MyDriver&a=deleteDrive&name=" + driveName + "&API=";
            get(url,function () {
                // 刷新列表
                loadDriverList();
            },true,true);
        });
    }

    // 重命名
    function renameDriver(driveName) {
        console.log("重命名:" + driveName);
    }
</script>
<{/block}>
<{block name="content"}>
<div class="aw-content-wrap">
    <div class="mod">
        <div class="layui-form" style="text-align: center;">
            <table class="layui-table">
                <colgroup>
                    <col width="150">
                    <col width="150">
                    <col width="150">
                    <col width="200">
                </colgroup>
                <thead>
                <tr>
                    <th>名称</th>
                    <th>类型</th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>
</div>
<{/block}>
